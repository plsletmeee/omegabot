<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset='UTF-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1.0'>
        <meta http-equiv='X-UA-Compatible' content='ie-edge'>
        <meta property='og:title' content='Omega Bot'>
        <meta property='og:description' content='The all in one Discord bot packed with server moderation tools, fun commands, tickets and more!'>
        <meta property='og:url' content='https://omegabot.xyz/'>
        <meta name='theme-color' content='#FF3F3F'>
        <meta name='description' content='The all in one Discord bot packed with server moderation tools, fun commands, tickets and more!'>
        <link rel='shortcut icon' href='/media/svgs/misc/omega.svg' type='image/x-icon'>
        <link rel='stylesheet' href='/css/dashboard/module.css' type='text/css'>
        <title>Link Detector - Omega</title>
    </head>
    <body>

        <header>
            <div class='header'>
                <a class='header-logo' href='/'><img src='/media/svgs/misc/banner.svg'></a>
                <a class='header-logout' href='/dashboard/logout' title='Logout'><span id='userLogout'></span><img src='/media/svgs/main/arrow-box.svg'></a>
            </div>
        </header>

        <main>
            <div class='sidebar'>
                <div class='sidebar-links'>
                    <a href='/dashboard'><span>Servers</span><img src='/media/svgs/main/servers.svg'></a>
                    <a class='selected' href='/dashboard/{serverId}/modules'><span>Modules</span><img src='/media/svgs/dashboard/gear.svg'></a>
                    <a class='disabled' title='Coming Soon!'><span>Vanities</span><img src='/media/svgs/dashboard/greyed-link.svg'></a>
                    <a class='disabled' title='Coming Soon!'><span>Forms</span><img src='/media/svgs/dashboard/greyed-clipboard.svg'></a>
                    <a class='disabled' title='Coming Soon!'><span>Bug Tracker</span><img src='/media/svgs/dashboard/greyed-bug.svg'></a>
                </div>
            </div>
            <section>
                <div class='main'>
                    <span class='title'>
                        <h1>Modules</h1>
                        <button class='navbar-button' onclick='toggleNavbar()'><img class='navbar-button-img' src='/media/svgs/main/hamburger.svg'></button>
                    </span>
                    <div class='navbar' style='display: none;'>
                        <div class='navbar-links'>
                            <a href='/dashboard'><span>Servers</span><img src='/media/svgs/main/servers.svg'></a>
                            <a href='/dashboard/{serverId}/modules'><span>Modules</span><img src='/media/svgs/dashboard/gear.svg'></a>
                            <a class='navbar-disabled' title='Coming Soon!'><span>Vanities</span><img src='/media/svgs/dashboard/greyed-link.svg'></a>
                            <a class='navbar-disabled' title='Coming Soon!'><span>Forms</span><img src='/media/svgs/dashboard/greyed-clipboard.svg'></a>
                            <a class='navbar-disabled' title='Coming Soon!'><span>Bug Tracker</span><img src='/media/svgs/dashboard/greyed-bug.svg'></a>
                        </div>
                    </div>
                    <div class='main-content'>
                        <div class='about'>
                            <span>
                                <h5>Link Detector</h5>
                                <p>Automatically delete links in text channels.</p>
                            </span>
                            <button class='switch switch-enabled' onclick='toggleEnabled()'>{moduleStatus}</button>
                        </div>
                        <div class='setting'>
                            <h5>Excluded Role</h5>
                            <p>Members of this role will be immune to the link detector.</p>
                            <br>
                            <button class='dropdown-button' onclick='toggleDropdown()'><span class='dropdown-selected'></span><span class='dropdown-arrow'></span></button>
                            <div class='dropdown-content'></div>
                        </div>
                    </div>
                </div>
            </section>
            <div class='notif'><img src='/media/svgs/dashboard/check.svg'>Updated Settings</div>
        </main>

    </body>

    <script defer>
        document.body.addEventListener('click', (event) => {
            if(!event.target.classList.contains('dropdown-button' || !event.target.classList.contains('dropdown-option'))) {
                let content = document.querySelector('.dropdown-content')
                let button = document.querySelector('.dropdown-button')
                let arrow = document.querySelector('.dropdown-arrow')

                if(content.style.display == 'flex') {
                    content.style.display = 'none'
                    button.style.borderRadius = '0.3rem'
                    arrow.style.rotate = '0deg'
                }
            }
        })
        
        function toggleNavbar() {
            let navbar = document.querySelector('.navbar')
            let button = document.querySelector('.navbar-button-img')

            if(navbar.style.display == 'none') navbar.style.display = 'flex', button.src = '/media/svgs/main/cross.svg'
            else navbar.style.display = 'none', button.src = '/media/svgs/main/hamburger.svg'
        }
        function toggleEnabled() {
            let button = document.querySelector('.switch')
            let notif = document.querySelector('.notif')

            if(button.textContent == 'Enabled' && !button.disabled) {
                button.textContent = 'Disabled'
                button.disabled = true

                fetch('/api/config/1', {
                    method: 'POST',
                    headers: { Authorization: `Bearer ${getCookie('omegaAuth')}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        guild: window.location.pathname.split('/dashboard/')[1].split('/modules/')[0].toString(),
                        enabled: false,
                    })
                }).then(res => { res.json().then(json => {
                        console.log(json)
                        if(json.code == 201) {
                            button.disabled = false
                            notif.style.opacity = 1
                            setTimeout(() => {
                                notif.style.opacity = 0
                            }, 3000)
                        }
                    })
                })
            } else if(button.textContent == 'Disabled') {
                button.textContent = 'Enabled'
                button.disabled = true

                fetch('/api/config/1', {
                    method: 'POST',
                    headers: { Authorization: `Bearer ${getCookie('omegaAuth')}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        guild: window.location.pathname.split('/dashboard/')[1].split('/modules/')[0].toString(),
                        enabled: true,
                    })
                }).then(res => { res.json().then(json => {
                        console.log(json)
                        if(json.code == 201) {
                            notif.style.opacity = 1
                            button.disabled = false
                            setTimeout(() => {
                                notif.style.opacity = 0
                            }, 3000)
                        }
                    })
                })
            }
        }
        function toggleDropdown() {
            let content = document.querySelector('.dropdown-content')
            let button = document.querySelector('.dropdown-button')
            let arrow = document.querySelector('.dropdown-arrow')
            if (content.style.display == 'flex') button.style.borderRadius = '0.3rem', arrow.style.rotate = '0deg', content.style.display = 'none'
            else content.style.display = 'flex', button.style.borderRadius = '0.3rem 0.3rem 0 0', arrow.style.rotate = '180deg'
        }
        function selectOption(element) {
            let content = document.querySelector('.dropdown-content')
            let button = document.querySelector('.dropdown-button')
            let selected = document.querySelector('.dropdown-selected')
            let arrow = document.querySelector('.dropdown-arrow')
            let notif = document.querySelector('.notif')

            selected.textContent = element.textContent
            selected.style.color = element.style.color
            content.style.display = 'none'
            button.style.borderRadius = '0.3rem'
            arrow.style.rotate = '0deg'

            fetch('/api/config/1', {
                method: 'POST',
                headers: { Authorization: `Bearer ${getCookie('omegaAuth')}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    guild: window.location.pathname.split('/dashboard/')[1].split('/modules/')[0].toString(),
                    exception: element.getAttribute('data-info')
                })
            }).then(res => { res.json().then(json => {
                    if(json.code == 201) {
                        notif.style.opacity = 1
                        setTimeout(() => {
                            notif.style.opacity = 0
                        }, 3000)
                    }
                })
            })
        }
        function getCookie(name) {
            const value = `; ${document.cookie}`
            const parts = value.split(`; ${name}=`)
            if(parts.length == 2) return parts.pop().split(';').shift()
        }
    </script>

</html>